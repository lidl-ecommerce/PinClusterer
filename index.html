<!DOCTYPE>
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta name="description" content="Clusters the closest pushpins together on Bing Map" />
  <meta name="keywords" content="PinClusterer bing map pin, bing map cluster, cluster, clusterer" />
	<title>PinClusterer : clustering pins on Bing maps</title>
	
	<link href="google-code-prettify/prettify.css" rel="stylesheet" />
	<link href="app.css" rel="stylesheet" />
	
	<script src="http://ecn.dev.virtualearth.net/mapcontrol/mapcontrol.ashx?v=7.0"></script>
</head>

<body>
	
	<div id="banner">
		<div><a href="https://github.com/rtsinani/PinClusterer">Fork me on github</a></div>
	</div>
	
	<article id="mainContainer">
		
		<header id="header">
			<h1 class="logo">Pin<i>C</i>lusterer <span>for bing maps</span></h1>
		</header>	
	
		<section class="cf">
			<aside id="content">
				<section>
					<p class="subtitle">
						<b>Pin Clusterer</b> is a small JavaScript layer for clustering pins on Bing maps (version 7.0).
					</p>
					<h2>Usage</h2>
					<p>
						The Clusterer's constructor accepts two arguments, an instance of the map, and few options.
						One of the options must be <code>latlongs</code>, which is an Array of objects
						with two properties: latitude and longitude
						(<a href="data.json" target="_blank">view the data used in this example here</a>).
					</p>
					
					<p>See below how the Clusterer is setup in order to display the pins on the map:</p>
					
<pre class="prettyprint linenums">
var map = new Microsoft.Maps.Map(document.getElementById('map'), {
    credentials: 'Your Bing Map Key here' 
  }),
		
  pinClusterer = new PinClusterer(map);

map.setView({ 
  center: new Microsoft.Maps.Location(data[0].latitude, data[0].longitude), 
  zoom  : 12
});

// data in this case is an array of objects 
// with properties: latitude and longitude
pinClusterer.cluster(data);
</pre>

					<h2>The grid size</h2>
					<p>
						The Clusterer groups the closest pins together based on a setting called <span class="code">gridSize</span>.
						The default value is 60px. The smaller this value, the denser are the clusters.
						You can pass this setting with the options when instatiating the Clusterer, but you can change it anytime. 
					</p>
					<p>
						<a href="#changegridsize" id="btnChangeGridSize">Click here</a> to set the grid size to 40px, and 
						<a href="#changegridsize" id="btnResetGridSize">here</a> to change it back to 60px.
					</p>
					
<pre class="prettyprint linenums">
var pinClusterer = new PinClusterer(map, {
  gridSize: 40
});
pinCluster.cluster(data);

pinCluster.setOptions({ gridSize: 30 });
pinCluster.cluster();
</pre>					
					
					<p>
						You can see the grids on the map by setting the debug option to true
						(<a id="btnDebug" href="#debug">click here</a> to do this live,
						or <a id="btnUndebug" href="#undebug">here</a> to turn the debug off):
					</p>

<pre class="prettyprint linenums">
pinCluster.setOptions({ debug: true });
pinCluster.cluster();
</pre>					
					
					<h2>The Pushpin settings</h2>
					<p>
						You can change the pin settings, such as its appearance and event handlers, as you would
						normally do with a <code>Microsoft.Maps.Pushpin</code>	instance. 
						The Clusterer exposes an event, <code>onClusterToMap</code>, 
						which you can pass an handler to via the settings. 
						The event is triggered just before it is added to the map.
					</p>
					
					<p>
						The code below hides the text from the pins, which shows the number of locations group within a cluster. 
						<a id="btnHideTextOn" href="#hidetext">Click here</a> to see this on the map, 
						or <a id="btnHideTextOff" href="#showtext">here</a> to show the text again.
					</p>

<pre class="prettyprint linenums">
pinCluster.setOptions({ 
  onClusterToMap: function (center) {
    center.setOptions({ text: '' });
  }
});
pinCluster.cluster();
</pre>
					
					<h2>Expanding the clusters</h2>
					<p>
						By default, when you click on the clusters that contain more than one pin, it will expand by zooming to the maximum zoom level,
						and so showing all the clusters as single pins. Try this now by clicking on any of the clusters on the map with numbers in them. 
						You can disable this by setting the options below:
					</p>
					
<pre class="prettyprint linenums">
pinCluster.setOptions({ clickToZoom: false });
</pre>					
					
					<h2>Stylesheets</h2>
					<p>
						The Clusterer includes a small CSS file, <a href="https://github.com/rtsinani/PinClusterer/blob/master/pin_clusterer.css" target="_blank">pin_clusterer.css</a>, which changes the style of the pushpins, to get the effect on the right.
						The stylesheet uses a few CSS3 features, such as <code>border-radius</code>, <code>box-shadow</code>, and <code>linear-gradient</code> 
						to create some nice-looking pins without the need of images.
					</p>
					<p> 
						This is made possible by the fact that the Clusterer adds two classes to the clusters: a general one for all the pins called <code>pin_cluster</code>, 
						and two specific ones: <code>cluster</code> for clusters with more more than one pin, 
						and <code>pin</code> for clusters with a single pin.
					</p>
					<p>
						Please note that adding these styles is absolutely unnecessary for the Clusterer to do its job, 
						and you can affect the clusters' look as you would do with any <code>Pushpin</code>: when setting the 
						<code>PushpinOptions</code> when setting the <code>onClusterToMap</code> handler (see above).
					</p>

					<div class="book">
						<a class="img" href="http://www.amazon.com/gp/product/1783550376?ie=UTF8&camp=213733&creative=393177&creativeASIN=1783550376&linkCode=shr&tag=newbusinessbe-20&keywords=learning%20bing%20maps%20api&qid=1385991720&ref_=sr_1_1&sr=8-1">
							<img src="images/book_cover.png" alt="Learning Bing Maps API. A book by Artan Sinani" />
						</a>

						<h2>
							Need more information about Bing Maps?
						</h2>
						<p>
							My new book, Learning Bing Maps API, is now out. <a href="mailto:artisinani@gmail.com">Email me</a> for a <b>free sample</b>, or order it now from <a href="http://www.packtpub.com/learning-bing-maps-api/book">Packt</a>.
						</p>
					</div>

					
					<h2>References</h2>
					<p>
						<ul class="references">
							<li>The <i>Pin Clusterer</i> ports <a href="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/" target="_blank">Google Maps MarkerClusterer</a> into Bing Maps.
							</li>
							<li>A great <a href="http://www.appelsiini.net/2008/11/introduction-to-marker-clustering-with-google-maps" target="_blank">article</a> by Mika Tuupola helped me understand how different clustering approaches work.</li>
							<li>An <a href="http://www.bing.com/community/site_blogs/b/maps/archive/2011/03/01/bing-maps-v7-modular-design-and-client-side-clustering.aspx" target="_blank">existing clusterer</a> 
								for Bing Maps by Ricky Brundritt showed me another way to do this.</li>
						</ul>					
					</p>
					
					<footer>
						Copyright &copy; 2012 Arti Sinani. Docs powered by HTML5.
					</footer>
				</section>
			</aside>
	
			<article id="map">
				Loading ...	
			</article>
		</section>
	</article>
	
	<div id="loader">
		<h1 class="logo">Pin<i>C</i>lusterer <span>for bing maps</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</h1>
	</div>
	
	<script src="jquery-1.7.1.js"></script>
	<script src="google-code-prettify/prettify.js"></script>
	<script src="pin_clusterer.js"></script>
	<script src="data.json"></script>
	<script src="app.js"></script>

	<script type="text/javascript">

	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-38583536-3']);
	  _gaq.push(['_trackPageview']);

	  (function() {
	    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();

</script>
</body>
</html>